<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Task 10 Integration Test</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      border-bottom: 3px solid #0073aa;
      padding-bottom: 10px;
    }
    h2 {
      color: #0073aa;
      margin-top: 30px;
    }
    .test-section {
      background: #f9f9f9;
      padding: 20px;
      margin: 20px 0;
      border-radius: 4px;
      border-left: 4px solid #0073aa;
    }
    .test-item {
      margin: 10px 0;
      padding: 10px;
      background: white;
      border-radius: 4px;
    }
    .status {
      display: inline-block;
      padding: 4px 12px;
      border-radius: 4px;
      font-weight: bold;
      font-size: 12px;
      margin-left: 10px;
    }
    .status.pass {
      background: #4caf50;
      color: white;
    }
    .status.fail {
      background: #f44336;
      color: white;
    }
    .status.pending {
      background: #ff9800;
      color: white;
    }
    button {
      background: #0073aa;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 14px;
      margin: 10px 10px 10px 0;
    }
    button:hover {
      background: #005a87;
    }
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    .log {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 15px;
      border-radius: 4px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      max-height: 400px;
      overflow-y: auto;
      margin-top: 20px;
    }
    .log-entry {
      margin: 5px 0;
      padding: 5px;
      border-left: 3px solid transparent;
    }
    .log-entry.success {
      border-left-color: #4caf50;
      color: #4caf50;
    }
    .log-entry.error {
      border-left-color: #f44336;
      color: #f44336;
    }
    .log-entry.info {
      border-left-color: #2196f3;
      color: #2196f3;
    }
    .log-entry.warning {
      border-left-color: #ff9800;
      color: #ff9800;
    }
    .instructions {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 4px;
      border-left: 4px solid #2196f3;
      margin: 20px 0;
    }
    .instructions h3 {
      margin-top: 0;
      color: #1976d2;
    }
    .instructions ol {
      margin: 10px 0;
      padding-left: 20px;
    }
    .instructions li {
      margin: 8px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>üß™ Task 10: Module Integration Test</h1>
    
    <div class="instructions">
      <h3>üìã Test Instructions</h3>
      <ol>
        <li>This page tests the integration of all modules in content.js</li>
        <li>Click "Run All Tests" to verify module loading and integration</li>
        <li>Check the console for detailed logs</li>
        <li>All tests should pass (green status)</li>
      </ol>
    </div>

    <div class="test-section">
      <h2>Module Loading Tests</h2>
      <div id="module-tests"></div>
      <button onclick="runModuleTests()">Test Module Loading</button>
    </div>

    <div class="test-section">
      <h2>Module Instance Tests</h2>
      <div id="instance-tests"></div>
      <button onclick="runInstanceTests()">Test Module Instances</button>
    </div>

    <div class="test-section">
      <h2>Integration Tests</h2>
      <div id="integration-tests"></div>
      <button onclick="runIntegrationTests()">Test Integration</button>
    </div>

    <div class="test-section">
      <h2>Error Handling Tests</h2>
      <div id="error-tests"></div>
      <button onclick="runErrorTests()">Test Error Handling</button>
    </div>

    <div style="margin-top: 20px;">
      <button onclick="runAllTests()" style="background: #4caf50; font-size: 16px; padding: 15px 30px;">
        ‚ñ∂Ô∏è Run All Tests
      </button>
      <button onclick="clearLog()">Clear Log</button>
    </div>

    <h2>Test Log</h2>
    <div id="log" class="log"></div>
  </div>

  <script>
    // Test utilities
    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const entry = document.createElement('div');
      entry.className = `log-entry ${type}`;
      entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(`[${type.toUpperCase()}] ${message}`);
    }

    function clearLog() {
      document.getElementById('log').innerHTML = '';
    }

    function addTestResult(containerId, testName, passed, details = '') {
      const container = document.getElementById(containerId);
      const testItem = document.createElement('div');
      testItem.className = 'test-item';
      
      const status = document.createElement('span');
      status.className = `status ${passed ? 'pass' : 'fail'}`;
      status.textContent = passed ? 'PASS' : 'FAIL';
      
      testItem.innerHTML = `<strong>${testName}</strong>`;
      testItem.appendChild(status);
      
      if (details) {
        const detailsDiv = document.createElement('div');
        detailsDiv.style.fontSize = '12px';
        detailsDiv.style.color = '#666';
        detailsDiv.style.marginTop = '5px';
        detailsDiv.textContent = details;
        testItem.appendChild(detailsDiv);
      }
      
      container.appendChild(testItem);
    }

    // Module Loading Tests
    function runModuleTests() {
      log('Starting module loading tests...', 'info');
      document.getElementById('module-tests').innerHTML = '';

      const modules = [
        'ElementorFormatConverter',
        'ElementorEditorDetector',
        'ClipboardManager',
        'PasteInterceptor',
        'EditorContextInjector',
        'MediaURLHandler',
        'VersionCompatibilityManager',
        'ContentSanitizer',
        'NotificationManager'
      ];

      modules.forEach(moduleName => {
        const exists = typeof window[moduleName] !== 'undefined';
        addTestResult('module-tests', `${moduleName} loaded`, exists, 
          exists ? 'Module class is available' : 'Module class not found');
        log(`Module ${moduleName}: ${exists ? 'LOADED' : 'NOT FOUND'}`, exists ? 'success' : 'error');
      });

      log('Module loading tests completed', 'success');
    }

    // Module Instance Tests
    function runInstanceTests() {
      log('Starting module instance tests...', 'info');
      document.getElementById('instance-tests').innerHTML = '';

      const instances = window.__elementorCopierInstances;
      
      if (!instances) {
        addTestResult('instance-tests', 'Instance container exists', false, 
          'window.__elementorCopierInstances not found');
        log('Instance container not found', 'error');
        return;
      }

      addTestResult('instance-tests', 'Instance container exists', true, 
        'window.__elementorCopierInstances is available');
      log('Instance container found', 'success');

      const expectedInstances = [
        'editorDetector',
        'clipboardManager',
        'pasteInterceptor',
        'editorInjector',
        'mediaURLHandler',
        'versionCompatibilityManager',
        'contentSanitizer',
        'notificationManager'
      ];

      expectedInstances.forEach(instanceName => {
        const exists = instances[instanceName] !== null && instances[instanceName] !== undefined;
        addTestResult('instance-tests', `${instanceName} instance`, exists,
          exists ? 'Instance created successfully' : 'Instance not created (may be expected if not in editor)');
        log(`Instance ${instanceName}: ${exists ? 'CREATED' : 'NOT CREATED'}`, exists ? 'success' : 'warning');
      });

      log('Module instance tests completed', 'success');
    }

    // Integration Tests
    function runIntegrationTests() {
      log('Starting integration tests...', 'info');
      document.getElementById('integration-tests').innerHTML = '';

      // Test 1: Check if content script is loaded
      const contentScriptLoaded = typeof window.__elementorCopierInstances !== 'undefined';
      addTestResult('integration-tests', 'Content script loaded', contentScriptLoaded,
        'Content script has initialized');
      log(`Content script: ${contentScriptLoaded ? 'LOADED' : 'NOT LOADED'}`, 
        contentScriptLoaded ? 'success' : 'error');

      // Test 2: Check if editor detection works
      if (window.__elementorCopierInstances?.editorDetector) {
        const detector = window.__elementorCopierInstances.editorDetector;
        const isEditor = detector.isElementorEditor();
        addTestResult('integration-tests', 'Editor detection', true,
          `Editor detected: ${isEditor ? 'Yes' : 'No (expected on non-editor pages)'}`);
        log(`Editor detection: ${isEditor ? 'IN EDITOR' : 'NOT IN EDITOR'}`, 'info');
      } else {
        addTestResult('integration-tests', 'Editor detection', false,
          'Editor detector not available');
        log('Editor detector not available', 'warning');
      }

      // Test 3: Check clipboard manager functionality
      if (window.__elementorCopierInstances?.clipboardManager) {
        const clipboardManager = window.__elementorCopierInstances.clipboardManager;
        const hasMethod = typeof clipboardManager.writeMultiFormat === 'function';
        addTestResult('integration-tests', 'Clipboard manager methods', hasMethod,
          'writeMultiFormat method is available');
        log(`Clipboard manager methods: ${hasMethod ? 'AVAILABLE' : 'NOT AVAILABLE'}`, 
          hasMethod ? 'success' : 'error');
      } else {
        addTestResult('integration-tests', 'Clipboard manager methods', false,
          'Clipboard manager not available');
        log('Clipboard manager not available', 'warning');
      }

      // Test 4: Check notification manager
      if (window.__elementorCopierInstances?.notificationManager) {
        const notificationManager = window.__elementorCopierInstances.notificationManager;
        const hasMethod = typeof notificationManager.success === 'function';
        addTestResult('integration-tests', 'Notification manager methods', hasMethod,
          'Notification methods are available');
        log(`Notification manager methods: ${hasMethod ? 'AVAILABLE' : 'NOT AVAILABLE'}`, 
          hasMethod ? 'success' : 'error');
      } else {
        addTestResult('integration-tests', 'Notification manager methods', false,
          'Notification manager not available');
        log('Notification manager not available', 'warning');
      }

      log('Integration tests completed', 'success');
    }

    // Error Handling Tests
    function runErrorTests() {
      log('Starting error handling tests...', 'info');
      document.getElementById('error-tests').innerHTML = '';

      // Test 1: Check if error handling functions exist
      const hasErrorHandling = typeof window.__elementorCopierInstances !== 'undefined';
      addTestResult('error-tests', 'Error handling system', hasErrorHandling,
        'Error handling infrastructure is in place');
      log(`Error handling system: ${hasErrorHandling ? 'AVAILABLE' : 'NOT AVAILABLE'}`, 
        hasErrorHandling ? 'success' : 'error');

      // Test 2: Test graceful degradation
      const modulesLoaded = window.__elementorCopierInstances ? 
        Object.keys(window.__elementorCopierInstances).length : 0;
      const gracefulDegradation = modulesLoaded > 0;
      addTestResult('error-tests', 'Graceful degradation', gracefulDegradation,
        `${modulesLoaded} modules loaded successfully`);
      log(`Graceful degradation: ${modulesLoaded} modules loaded`, 'info');

      // Test 3: Check notification system for errors
      if (window.__elementorCopierInstances?.notificationManager) {
        const canShowErrors = typeof window.__elementorCopierInstances.notificationManager.error === 'function';
        addTestResult('error-tests', 'Error notification capability', canShowErrors,
          'Can show error notifications to users');
        log(`Error notifications: ${canShowErrors ? 'AVAILABLE' : 'NOT AVAILABLE'}`, 
          canShowErrors ? 'success' : 'error');
      } else {
        addTestResult('error-tests', 'Error notification capability', false,
          'Notification manager not available');
        log('Error notification system not available', 'warning');
      }

      log('Error handling tests completed', 'success');
    }

    // Run all tests
    async function runAllTests() {
      log('='.repeat(60), 'info');
      log('STARTING COMPREHENSIVE TEST SUITE', 'info');
      log('='.repeat(60), 'info');
      
      clearLog();
      
      // Clear all test results
      document.getElementById('module-tests').innerHTML = '';
      document.getElementById('instance-tests').innerHTML = '';
      document.getElementById('integration-tests').innerHTML = '';
      document.getElementById('error-tests').innerHTML = '';
      
      // Run tests sequentially
      runModuleTests();
      await new Promise(resolve => setTimeout(resolve, 500));
      
      runInstanceTests();
      await new Promise(resolve => setTimeout(resolve, 500));
      
      runIntegrationTests();
      await new Promise(resolve => setTimeout(resolve, 500));
      
      runErrorTests();
      
      log('='.repeat(60), 'info');
      log('ALL TESTS COMPLETED', 'success');
      log('='.repeat(60), 'info');
      log('Check the results above for any failures', 'info');
    }

    // Initialize
    log('Test page loaded. Click "Run All Tests" to begin.', 'info');
    log('Note: Some tests may show warnings if not in Elementor editor - this is expected.', 'warning');
  </script>
</body>
</html>
