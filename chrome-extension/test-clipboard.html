<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Clipboard Integration Test</title>
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      max-width: 800px;
      margin: 50px auto;
      padding: 20px;
      background: #f5f5f5;
    }
    .container {
      background: white;
      padding: 30px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
    }
    .test-section {
      margin-bottom: 30px;
      padding: 20px;
      background: #f9f9f9;
      border-radius: 6px;
      border-left: 4px solid #667eea;
    }
    .test-section h2 {
      font-size: 18px;
      margin-bottom: 15px;
      color: #333;
    }
    .test-section p {
      color: #666;
      margin-bottom: 15px;
      line-height: 1.6;
    }
    button {
      padding: 10px 20px;
      background: #667eea;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
      margin-right: 10px;
      margin-bottom: 10px;
    }
    button:hover {
      background: #5568d3;
    }
    button.secondary {
      background: #6c757d;
    }
    button.secondary:hover {
      background: #5a6268;
    }
    .result {
      margin-top: 15px;
      padding: 15px;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      display: none;
    }
    .result.success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
      display: block;
    }
    .result.error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
      display: block;
    }
    .result.info {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
      display: block;
    }
    textarea {
      width: 100%;
      height: 200px;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      margin-top: 10px;
    }
    .browser-info {
      background: #e7f3ff;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    .browser-info h3 {
      margin-bottom: 10px;
      color: #0066cc;
    }
    .browser-info ul {
      margin-left: 20px;
      color: #333;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ§ª Clipboard Integration Test</h1>
    <p class="subtitle">Test the Elementor Copier clipboard functionality across different browsers</p>

    <div class="browser-info">
      <h3>Browser Information</h3>
      <ul id="browserInfo">
        <li>Loading...</li>
      </ul>
    </div>

    <!-- Test 1: Basic Clipboard Write -->
    <div class="test-section">
      <h2>Test 1: Basic Clipboard Write</h2>
      <p>Tests if the browser supports the Clipboard API and can write text to clipboard.</p>
      <button onclick="testBasicClipboard()">Run Test</button>
      <div id="result1" class="result"></div>
    </div>

    <!-- Test 2: Large Data -->
    <div class="test-section">
      <h2>Test 2: Large JSON Data</h2>
      <p>Tests clipboard with large JSON payload (simulating full page copy).</p>
      <button onclick="testLargeData()">Run Test</button>
      <div id="result2" class="result"></div>
    </div>

    <!-- Test 3: Read Clipboard -->
    <div class="test-section">
      <h2>Test 3: Read from Clipboard</h2>
      <p>Tests if the browser can read from clipboard (for paste functionality).</p>
      <button onclick="testReadClipboard()">Run Test</button>
      <div id="result3" class="result"></div>
    </div>

    <!-- Test 4: Fallback Method -->
    <div class="test-section">
      <h2>Test 4: Fallback Copy Method</h2>
      <p>Tests the execCommand fallback for older browsers.</p>
      <button onclick="testFallbackCopy()">Run Test</button>
      <textarea id="fallbackText" readonly>{"test": "fallback data"}</textarea>
      <div id="result4" class="result"></div>
    </div>

    <!-- Test 5: Permission Check -->
    <div class="test-section">
      <h2>Test 5: Clipboard Permission</h2>
      <p>Checks clipboard permission status.</p>
      <button onclick="testPermission()">Check Permission</button>
      <div id="result5" class="result"></div>
    </div>

    <!-- Test 6: Sample Elementor Data -->
    <div class="test-section">
      <h2>Test 6: Copy Sample Elementor Data</h2>
      <p>Copy sample Elementor widget data to clipboard.</p>
      <button onclick="copySampleData()">Copy Sample Widget</button>
      <button class="secondary" onclick="viewSampleData()">View Sample Data</button>
      <div id="result6" class="result"></div>
      <textarea id="sampleData" style="display:none;"></textarea>
    </div>

    <!-- Run All Tests -->
    <div style="text-align: center; margin-top: 30px;">
      <button onclick="runAllTests()" style="padding: 15px 30px; font-size: 16px;">
        ðŸš€ Run All Tests
      </button>
    </div>
  </div>

  <script>
    // Display browser information
    function displayBrowserInfo() {
      const info = document.getElementById('browserInfo');
      const ua = navigator.userAgent;
      let browser = 'Unknown';
      
      if (ua.includes('Chrome') && !ua.includes('Edg')) browser = 'Chrome';
      else if (ua.includes('Edg')) browser = 'Edge';
      else if (ua.includes('Firefox')) browser = 'Firefox';
      else if (ua.includes('Safari') && !ua.includes('Chrome')) browser = 'Safari';
      
      const hasClipboardAPI = !!navigator.clipboard;
      const hasWriteText = hasClipboardAPI && !!navigator.clipboard.writeText;
      const hasReadText = hasClipboardAPI && !!navigator.clipboard.readText;
      
      info.innerHTML = `
        <li><strong>Browser:</strong> ${browser}</li>
        <li><strong>User Agent:</strong> ${ua}</li>
        <li><strong>Clipboard API:</strong> ${hasClipboardAPI ? 'âœ“ Supported' : 'âœ— Not Supported'}</li>
        <li><strong>writeText:</strong> ${hasWriteText ? 'âœ“ Available' : 'âœ— Not Available'}</li>
        <li><strong>readText:</strong> ${hasReadText ? 'âœ“ Available' : 'âœ— Not Available'}</li>
      `;
    }

    // Test 1: Basic clipboard write
    async function testBasicClipboard() {
      const result = document.getElementById('result1');
      try {
        if (!navigator.clipboard || !navigator.clipboard.writeText) {
          throw new Error('Clipboard API not available');
        }
        
        const testData = 'Elementor Copier Test - ' + new Date().toISOString();
        await navigator.clipboard.writeText(testData);
        
        result.className = 'result success';
        result.textContent = 'âœ“ Success! Text copied to clipboard: ' + testData;
      } catch (error) {
        result.className = 'result error';
        result.textContent = 'âœ— Error: ' + error.message;
      }
    }

    // Test 2: Large data
    async function testLargeData() {
      const result = document.getElementById('result2');
      try {
        // Generate large JSON (simulating full page)
        const largeData = {
          version: '1.0.0',
          type: 'elementor-copier',
          elementType: 'page',
          data: {
            elements: Array(100).fill(null).map((_, i) => ({
              id: 'element_' + i,
              elType: 'widget',
              widgetType: 'heading',
              settings: {
                title: 'Test Heading ' + i,
                color: '#000000'
              }
            }))
          },
          metadata: {
            sourceUrl: window.location.href,
            copiedAt: new Date().toISOString()
          }
        };
        
        const jsonString = JSON.stringify(largeData, null, 2);
        const sizeKB = (new Blob([jsonString]).size / 1024).toFixed(2);
        
        await navigator.clipboard.writeText(jsonString);
        
        result.className = 'result success';
        result.textContent = `âœ“ Success! Large JSON (${sizeKB} KB) copied to clipboard`;
      } catch (error) {
        result.className = 'result error';
        result.textContent = 'âœ— Error: ' + error.message;
      }
    }

    // Test 3: Read clipboard
    async function testReadClipboard() {
      const result = document.getElementById('result3');
      try {
        if (!navigator.clipboard || !navigator.clipboard.readText) {
          throw new Error('Clipboard read not available');
        }
        
        const text = await navigator.clipboard.readText();
        
        result.className = 'result success';
        result.textContent = 'âœ“ Success! Read from clipboard:\n' + text.substring(0, 200) + (text.length > 200 ? '...' : '');
      } catch (error) {
        result.className = 'result error';
        result.textContent = 'âœ— Error: ' + error.message + '\n\nNote: Some browsers require user interaction to read clipboard.';
      }
    }

    // Test 4: Fallback copy
    function testFallbackCopy() {
      const result = document.getElementById('result4');
      const textarea = document.getElementById('fallbackText');
      
      try {
        textarea.select();
        textarea.setSelectionRange(0, 99999);
        
        const success = document.execCommand('copy');
        
        if (success) {
          result.className = 'result success';
          result.textContent = 'âœ“ Success! Fallback copy using execCommand worked';
        } else {
          throw new Error('execCommand returned false');
        }
      } catch (error) {
        result.className = 'result error';
        result.textContent = 'âœ— Error: ' + error.message;
      }
    }

    // Test 5: Permission check
    async function testPermission() {
      const result = document.getElementById('result5');
      try {
        if (!navigator.permissions || !navigator.permissions.query) {
          throw new Error('Permissions API not available');
        }
        
        const permission = await navigator.permissions.query({ name: 'clipboard-write' });
        
        result.className = 'result info';
        result.textContent = `Clipboard Write Permission: ${permission.state}\n\nStates:\n- granted: Permission granted\n- denied: Permission denied\n- prompt: Will prompt user`;
        
        permission.onchange = () => {
          result.textContent += `\n\nPermission changed to: ${permission.state}`;
        };
      } catch (error) {
        result.className = 'result error';
        result.textContent = 'âœ— Error: ' + error.message + '\n\nNote: Some browsers don\'t support permission queries for clipboard.';
      }
    }

    // Copy sample Elementor data
    async function copySampleData() {
      const result = document.getElementById('result6');
      try {
        const sampleData = {
          version: '1.0.0',
          type: 'elementor-copier',
          elementType: 'widget',
          data: {
            id: 'abc123',
            elType: 'widget',
            widgetType: 'heading',
            settings: {
              title: 'Sample Heading',
              title_color: '#000000',
              typography_font_family: 'Roboto',
              typography_font_size: { unit: 'px', size: 32 }
            }
          },
          media: [],
          metadata: {
            sourceUrl: window.location.href,
            copiedAt: new Date().toISOString(),
            elementorVersion: '3.16.0',
            pageTitle: 'Test Page'
          }
        };
        
        const jsonString = JSON.stringify(sampleData, null, 2);
        document.getElementById('sampleData').value = jsonString;
        
        await navigator.clipboard.writeText(jsonString);
        
        result.className = 'result success';
        result.textContent = 'âœ“ Success! Sample widget data copied to clipboard.\n\nYou can now paste this in the WordPress Elementor Copier plugin.';
      } catch (error) {
        result.className = 'result error';
        result.textContent = 'âœ— Error: ' + error.message;
      }
    }

    // View sample data
    function viewSampleData() {
      const textarea = document.getElementById('sampleData');
      textarea.style.display = textarea.style.display === 'none' ? 'block' : 'none';
    }

    // Run all tests
    async function runAllTests() {
      await testBasicClipboard();
      await new Promise(resolve => setTimeout(resolve, 500));
      await testLargeData();
      await new Promise(resolve => setTimeout(resolve, 500));
      await testReadClipboard();
      await new Promise(resolve => setTimeout(resolve, 500));
      testFallbackCopy();
      await new Promise(resolve => setTimeout(resolve, 500));
      await testPermission();
      await new Promise(resolve => setTimeout(resolve, 500));
      await copySampleData();
    }

    // Initialize
    displayBrowserInfo();
  </script>
</body>
</html>
